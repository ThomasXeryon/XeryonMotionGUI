<UserControl
    x:Class="XeryonMotionGUI.DraggableElement"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:helpers="using:XeryonMotionGUI.Helpers"
    xmlns:local="using:XeryonMotionGUI"
    x:Name="DraggableElementRoot"
    DataContext="{Binding RelativeSource={RelativeSource Self}}"
    Width="{Binding Block.Width, Mode=TwoWay}"
    Height="{Binding Block.Height, Mode=TwoWay}">

    <UserControl.Resources>
        <helpers:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid>
        <!-- Default Block Layout (for non-Repeat blocks) -->
        <Border x:Name="DefaultBlockLayout"
            CornerRadius="5"
            Padding="10"
            Background="{Binding Background, ElementName=DraggableElementRoot}"
            BorderThickness="1"
            BorderBrush="Black"
            Visibility="{Binding Text, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Step +|Step -|Wait'}">
            <StackPanel>
                <TextBlock
                    Text="{Binding Text}"
                    FontWeight="Bold"
                    Margin="0,0,0,5"
                    HorizontalAlignment="Center" />

                <ComboBox
                    ItemsSource="{Binding RunningControllers}"
                    SelectedItem="{Binding Block.SelectedController, Mode=TwoWay}"
                    DisplayMemberPath="FriendlyName"
                    Visibility="{Binding Text, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Step +|Step -'}"
                    Margin="0,5,0,5"
                    PlaceholderText="Select Controller" />

                <ComboBox
                    ItemsSource="{Binding Block.SelectedController.Axes}"
                    SelectedItem="{Binding Block.SelectedAxis, Mode=TwoWay}"
                    DisplayMemberPath="FriendlyName"
                    Visibility="{Binding Text, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Step +|Step -'}"
                    Margin="0,5,0,5"
                    PlaceholderText="Select Axis" />

                <NumberBox
                    x:Name="WaitTimeInput"
                    Header="Wait time (ms)"
                    Value="{Binding Block.WaitTime, Mode=TwoWay}"
                    Visibility="{Binding Text, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Wait'}"
                    Margin="0,5,0,5"
                    PlaceholderText="Enter wait time" />
            </StackPanel>
        </Border>

        <!-- Repeat Block Layout -->
        <Border x:Name="RepeatBlockLayout"
                CornerRadius="5"
                Padding="10"
                Background="LightGray"
                BorderThickness="1"
                BorderBrush="Black"
                Visibility="{Binding Text, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter='Repeat'}">

            <StackPanel>
                <TextBlock
                    Text="Repeat"
                    FontWeight="Bold"
                    Margin="0,0,0,5"
                    HorizontalAlignment="Center" />

                <NumberBox
                    x:Name="RepeatCountInput"
                    Header="Repeat count"
                    Value="{Binding Block.RepeatCount, Mode=TwoWay}"
                    Margin="0,5,0,5"
                    PlaceholderText="Enter repeat times" />

                <NumberBox
                    x:Name="BlocksToRepeatInput"
                    Header="Blocks to repeat"
                    Value="{Binding Block.BlocksToRepeat, Mode=TwoWay}"
                    Margin="0,5,0,5"
                    PlaceholderText="Enter number of blocks" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>